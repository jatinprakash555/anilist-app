<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Anilist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            sendEmailVerification,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    </script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #000000; }
        body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(125deg, #000000, #1f1f1f, #991b1b, #dc2626, #000000); background-size: 400% 400%; animation: gradientAnimation 25s ease infinite; z-index: -1; }
        @keyframes gradientAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .form-container { background: rgba(17, 17, 17, 0.6); backdrop-filter: blur(15px); border: 1px solid rgba(51, 51, 51, 0.5); }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #dc2626; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-300 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white flex items-center justify-center gap-2">
                <i data-lucide="clapperboard" class="text-red-500 h-10 w-10"></i>
                <span>Ani<span class="text-red-500">List</span></span>
            </h1>
            <p class="text-gray-400 mt-2">Sign in to continue to your personal watchlist.</p>
        </div>

        <div class="form-container p-8 rounded-lg shadow-2xl">
            <button id="google-signin-btn" class="w-full flex items-center justify-center gap-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition mb-6 disabled:opacity-50">
                <svg class="w-6 h-6" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"></path><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"></path><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"></path><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.571l6.19 5.238C42.021 35.637 44 30.138 44 24c0-1.341-.138-2.65-.389-3.917z"></path></svg>
                <span class="btn-text">Sign in with Google</span>
                <div class="loader hidden"></div>
            </button>
            <div class="relative mb-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-600"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-gray-800 text-gray-400">Or continue with email</span></div></div>
            <form id="email-form" class="space-y-4">
                <div><label for="email" class="sr-only">Email</label><input type="email" id="email" required class="w-full bg-gray-700 border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Email address"></div>
                <div class="relative"><label for="password" class="sr-only">Password</label><input type="password" id="password" required class="w-full bg-gray-700 border border-gray-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Password"><button type="button" id="toggle-password" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white"><i data-lucide="eye" class="h-5 w-5"></i></button></div>
                <div class="text-right"><a href="#" id="forgot-password-link" class="text-sm text-red-400 hover:underline">Forgot Password?</a></div>
                <div id="form-error" class="text-red-400 text-sm hidden"></div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="signin-btn" type="button" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50"><span class="btn-text">Sign In</span><div class="loader hidden"></div></button>
                    <button id="signup-btn" type="button" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50"><span class="btn-text">Sign Up</span><div class="loader hidden"></div></button>
                </div>
            </form>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyBBqEu81eWcRDbDF-4pehrI9yOu4fIP_ps",
          authDomain: "anilist-34804.firebaseapp.com",
          projectId: "anilist-34804",
          storageBucket: "anilist-34804.firebasestorage.app",
          messagingSenderId: "313389648813",
          appId: "1:313389648813:web:815535b3b0b17e71d9ef24",
        };

        lucide.createIcons();
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, user => { if (user && !user.isAnonymous) { window.location.href = 'anime-watchlist.html'; } });
        const googleBtn = document.getElementById('google-signin-btn'), emailInput = document.getElementById('email'), passwordInput = document.getElementById('password'), signinBtn = document.getElementById('signin-btn'), signupBtn = document.getElementById('signup-btn'), errorDiv = document.getElementById('form-error'), togglePasswordBtn = document.getElementById('toggle-password'), forgotPasswordLink = document.getElementById('forgot-password-link');
        const allButtons = [googleBtn, signinBtn, signupBtn];
        function setLoading(button, isLoading) {
            const btnText = button.querySelector('.btn-text'), loader = button.querySelector('.loader');
            if (isLoading) { allButtons.forEach(btn => btn.disabled = true); if (btnText) btnText.classList.add('hidden'); if (loader) loader.classList.remove('hidden');
            } else { allButtons.forEach(btn => btn.disabled = false); if (btnText) btnText.classList.remove('hidden'); if (loader) loader.classList.add('hidden'); }
        }
        googleBtn.addEventListener('click', async () => { setLoading(googleBtn, true); const provider = new GoogleAuthProvider(); try { await signInWithPopup(auth, provider); } catch (error) { showError(error.message); setLoading(googleBtn, false); } });
        signupBtn.addEventListener('click', async () => { const email = emailInput.value, password = passwordInput.value; if (!email || !password) { showError("Please enter both email and password."); return; } setLoading(signupBtn, true); try { const userCredential = await createUserWithEmailAndPassword(auth, email, password); await sendEmailVerification(userCredential.user); alert("Verification email sent! Please check your inbox to verify your account before signing in."); } catch (error) { showError(getFriendlyErrorMessage(error)); } finally { setLoading(signupBtn, false); } });
        signinBtn.addEventListener('click', async () => { const email = emailInput.value, password = passwordInput.value; if (!email || !password) { showError("Please enter both email and password."); return; } setLoading(signinBtn, true); try { const userCredential = await signInWithEmailAndPassword(auth, email, password); if (!userCredential.user.emailVerified) { alert("Please verify your email address first. Check your inbox for the verification link."); setLoading(signinBtn, false); return; } } catch (error) { showError(getFriendlyErrorMessage(error)); setLoading(signinBtn, false); } });
        togglePasswordBtn.addEventListener('click', () => { const isPassword = passwordInput.type === 'password'; passwordInput.type = isPassword ? 'text' : 'password'; const icon = togglePasswordBtn.querySelector('i'); icon.setAttribute('data-lucide', isPassword ? 'eye-off' : 'eye'); lucide.createIcons(); });
        forgotPasswordLink.addEventListener('click', async (e) => { e.preventDefault(); const email = emailInput.value; if (!email) { showError("Please enter your email address to reset your password."); return; } try { await sendPasswordResetEmail(auth, email); alert("Password reset email sent! Please check your inbox."); showError(""); } catch (error) { showError(getFriendlyErrorMessage(error)); } });
        function showError(message) { errorDiv.textContent = message; errorDiv.classList.toggle('hidden', !message); }
        function getFriendlyErrorMessage(error) { switch(error.code) { case 'auth/invalid-email': return 'Please enter a valid email address.'; case 'auth/user-not-found': case 'auth/wrong-password': case 'auth/invalid-credential': return 'Invalid email or password.'; case 'auth/email-already-in-use': return 'An account with this email already exists.'; case 'auth/weak-password': return 'Password should be at least 6 characters long.'; default: return 'An unexpected error occurred. Please try again.'; } }
    </script>
</body>
</html>

